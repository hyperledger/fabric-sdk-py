

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial of Using Fabric Python SDK &mdash; fabric-sdk-py  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Release Notes" href="release_note.html" />
    <link rel="prev" title="Welcome to fabric-sdk-py’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> fabric-sdk-py
          

          
          </a>

          
            
            
              <div class="version">
                0.9.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prepare-a-testing-environment">0. Prepare a Testing Environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-fabric-sdk">0.1. Install Fabric SDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-a-fabric-network">0.2. Setup a Fabric Network</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-the-connection-profile">0.3. Create the Connection Profile</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#get-credentials">1. Get Credentials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#load-the-connection-profile">1.1 Load the Connection Profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prepare-user-id-optionally">1.2 Prepare User Id (Optionally)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-local-credential">1.2.1 Using Local Credential</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-credentail-from-fabric-ca">1.2.2 Get Credentail from Fabric CA</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#operate-channels-with-fabric-network">2. Operate Channels with Fabric Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-a-new-channel-and-join-it">2.1 Create a new channel and join it</a></li>
<li class="toctree-l3"><a class="reference internal" href="#update-the-channel-configuration">2.2 Update the Channel Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#operate-chaincodes-with-fabric-network">3. Operate Chaincodes with Fabric Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#query-informations">4. Query Informations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-usage">4.1 Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#query-block-by-block-hash-transaction-id">4.2 Query Block by block hash &amp; transaction id</a></li>
<li class="toctree-l3"><a class="reference internal" href="#query-block-transaction-and-instantiated-chaincodes">4.3 Query Block, Transaction and Instantiated Chaincodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-channel-configuration">4.4 Get channel configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-channel-discovery">4.5 Use channel discovery</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#license-a-name-license-a">License <a name="license"></a></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="release_note.html">Release Note</a><ul>
<li class="toctree-l2"><a class="reference internal" href="release_note.html#v0-8-0-apr-12-2019">v0.8.0 Apr 12, 2019</a><ul>
<li class="toctree-l3"><a class="reference internal" href="release_note.html#add-new-features">Add new features</a></li>
<li class="toctree-l3"><a class="reference internal" href="release_note.html#improvements">Improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="release_note.html#known-vulnerabilities">Known Vulnerabilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="release_note.html#resolved-vulnerabilities">Resolved Vulnerabilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="release_note.html#change-log">Change Log</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="code_style.html">Code Style</a><ul>
<li class="toctree-l2"><a class="reference internal" href="code_style.html#license-a-name-license-a">License <a name="license"></a></a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">fabric-sdk-py</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Tutorial of Using Fabric Python SDK</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial-of-using-fabric-python-sdk">
<h1>Tutorial of Using Fabric Python SDK<a class="headerlink" href="#tutorial-of-using-fabric-python-sdk" title="Permalink to this headline">¶</a></h1>
<p><strong>Note: Python3 is required, and the sample code can be found at <a class="reference external" href="sample.py">sample.py</a>.</strong></p>
<p>TLDR, run a quick testing.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">HLF_VERSION</span><span class="o">=</span><span class="m">1</span>.4.0
$ docker pull hyperledger/fabric-peer:<span class="si">${</span><span class="nv">HLF_VERSION</span><span class="si">}</span> <span class="se">\</span>
    <span class="o">&amp;&amp;</span> docker pull hyperledger/fabric-orderer:<span class="si">${</span><span class="nv">HLF_VERSION</span><span class="si">}</span> <span class="se">\</span>
    <span class="o">&amp;&amp;</span> docker pull hyperledger/fabric-ca:<span class="si">${</span><span class="nv">HLF_VERSION</span><span class="si">}</span> <span class="se">\</span>
    <span class="o">&amp;&amp;</span> docker pull hyperledger/fabric-ccenv:<span class="si">${</span><span class="nv">HLF_VERSION</span><span class="si">}</span>
$ docker-compose -f test/fixtures/docker-compose-2orgs-4peers-tls.yaml up
$ pip3 install virtualenv<span class="p">;</span> make venv
$ <span class="nb">source</span> venv/bin/activate
$ make install
$ python docs/sample.py
$ deactive
</pre></div>
</div>
<div class="section" id="prepare-a-testing-environment">
<h2>0. Prepare a Testing Environment<a class="headerlink" href="#prepare-a-testing-environment" title="Permalink to this headline">¶</a></h2>
<div class="section" id="install-fabric-sdk">
<h3>0.1. Install Fabric SDK<a class="headerlink" href="#install-fabric-sdk" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/hyperledger/fabric-sdk-py.git
$ <span class="nb">cd</span> fabric-sdk-py
$ make install
</pre></div>
</div>
<p>Optionally, you can also verify the version number or run all testing cases.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python
&gt;&gt;&gt; import hfc
&gt;&gt;&gt; print<span class="o">(</span>hfc.VERSION<span class="o">)</span>
<span class="m">0</span>.9.0
&gt;&gt;&gt; exit<span class="o">()</span>

$ make check
</pre></div>
</div>
</div>
<div class="section" id="setup-a-fabric-network">
<h3>0.2. Setup a Fabric Network<a class="headerlink" href="#setup-a-fabric-network" title="Permalink to this headline">¶</a></h3>
<p>If you already have a running fabric network, ignore this.</p>
<p>To start an example fabric network you can simply run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">HLF_VERSION</span><span class="o">=</span><span class="m">1</span>.4.0
$ docker pull hyperledger/fabric-peer:<span class="si">${</span><span class="nv">HLF_VERSION</span><span class="si">}</span>
$ docker pull hyperledger/fabric-orderer:<span class="si">${</span><span class="nv">HLF_VERSION</span><span class="si">}</span>
$ docker pull hyperledger/fabric-ca:<span class="si">${</span><span class="nv">HLF_VERSION</span><span class="si">}</span>
$ docker pull hyperledger/fabric-ccenv:<span class="si">${</span><span class="nv">HLF_VERSION</span><span class="si">}</span>
$ docker-compose -f test/fixtures/docker-compose-2orgs-4peers-tls.yaml up
</pre></div>
</div>
<p>Then you’ll have a fabric network with 3 organizations, 4 peers and 1 orderer:</p>
<ul class="simple">
<li><p>org1.example.com</p>
<ul>
<li><p>peer0.org1.example.com</p></li>
<li><p>peer1.org1.example.com</p></li>
</ul>
</li>
<li><p>org2.example.com</p>
<ul>
<li><p>peer0.org2.example.com</p></li>
<li><p>peer1.org2.example.com</p></li>
</ul>
</li>
<li><p>orderer.example.com</p>
<ul>
<li><p>orderer.example.com</p></li>
</ul>
</li>
<li><p>Note: make sure <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> is in the ‘$PATH’.</p></li>
</ul>
<p>If you want to understand more details on starting up a fabric network, feel free to see the <a class="reference external" href="https://hyperledger-fabric.readthedocs.io/en/latest/build_network.html">Building Your First Network</a> tutorial.</p>
</div>
<div class="section" id="create-the-connection-profile">
<h3>0.3. Create the Connection Profile<a class="headerlink" href="#create-the-connection-profile" title="Permalink to this headline">¶</a></h3>
<p>A network connection profile helps SDK connect to the fabric network by providing all required information to operate with a fabric network, including:</p>
<ul class="simple">
<li><p>Client credentials file location;</p></li>
<li><p>Service endpoints for peer, orderer and ca;</p></li>
</ul>
<p>The <a class="reference external" href="test/fixtures/network.json">network.json</a> is an example, please modify the content accordingly.</p>
<p>Now you can use the Python SDK to work with the fabric network!</p>
</div>
</div>
<div class="section" id="get-credentials">
<h2>1. Get Credentials<a class="headerlink" href="#get-credentials" title="Permalink to this headline">¶</a></h2>
<div class="section" id="load-the-connection-profile">
<h3>1.1 Load the Connection Profile<a class="headerlink" href="#load-the-connection-profile" title="Permalink to this headline">¶</a></h3>
<p>Load all network information from the profile, and check the resources.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hfc.fabric</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">cli</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">net_profile</span><span class="o">=</span><span class="s2">&quot;test/fixtures/network.json&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">organizations</span><span class="p">)</span>  <span class="c1"># orgs in the network</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">peers</span><span class="p">)</span>  <span class="c1"># peers in the network</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">orderers</span><span class="p">)</span>  <span class="c1"># orderers in the network</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">CAs</span><span class="p">)</span>  <span class="c1"># ca nodes in the network</span>
</pre></div>
</div>
</div>
<div class="section" id="prepare-user-id-optionally">
<h3>1.2 Prepare User Id (Optionally)<a class="headerlink" href="#prepare-user-id-optionally" title="Permalink to this headline">¶</a></h3>
<p>SDK need the credential file as a valid network user.</p>
<p>Typically there are two ways: using cryptogen or using Fabric-CA. That will depend on how your network boots up with.</p>
<div class="section" id="using-local-credential">
<h4>1.2.1 Using Local Credential<a class="headerlink" href="#using-local-credential" title="Permalink to this headline">¶</a></h4>
<p>SDK will load the valid credential from local path (the credentail files must be put there in advance).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hfc.fabric</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">cli</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">net_profile</span><span class="o">=</span><span class="s2">&quot;test/fixtures/network.json&quot;</span><span class="p">)</span>
<span class="n">org1_admin</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">org_name</span><span class="o">=</span><span class="s1">&#39;org1.example.com&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Admin&#39;</span><span class="p">)</span> <span class="c1"># get the admin user from local path</span>
</pre></div>
</div>
</div>
<div class="section" id="get-credentail-from-fabric-ca">
<h4>1.2.2 Get Credentail from Fabric CA<a class="headerlink" href="#get-credentail-from-fabric-ca" title="Permalink to this headline">¶</a></h4>
<p>Here demos how to interact with Fabric CA.</p>
<ul class="simple">
<li><p>Enroll into Fabric CA with admin role;</p></li>
<li><p>Register a user <code class="docutils literal notranslate"><span class="pre">user1</span></code>;</p></li>
<li><p>Enroll with the new user <code class="docutils literal notranslate"><span class="pre">user1</span></code> and get local credential;</p></li>
<li><p>Re-enroll the <code class="docutils literal notranslate"><span class="pre">user1</span></code>;</p></li>
<li><p>Revoke the <code class="docutils literal notranslate"><span class="pre">user1</span></code>.</p></li>
</ul>
<p>To use CA, a CA server must be started. For example,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker-compose -f test/fixtures/ca/docker-compose.yml up
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hfc.fabric_ca.caservice</span> <span class="kn">import</span> <span class="n">ca_service</span>

<span class="n">casvc</span> <span class="o">=</span> <span class="n">ca_service</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;http://127.0.0.1:7054&quot;</span><span class="p">)</span>
<span class="n">adminEnrollment</span> <span class="o">=</span> <span class="n">casvc</span><span class="o">.</span><span class="n">enroll</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;adminpw&quot;</span><span class="p">)</span> <span class="c1"># now local will have the admin enrollment</span>
<span class="n">secret</span> <span class="o">=</span> <span class="n">adminEnrollment</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;user1&quot;</span><span class="p">)</span> <span class="c1"># register a user to ca</span>
<span class="n">user1Enrollment</span> <span class="o">=</span> <span class="n">casvc</span><span class="o">.</span><span class="n">enroll</span><span class="p">(</span><span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span> <span class="c1"># now local will have the user enrollment</span>
<span class="n">user1ReEnrollment</span> <span class="o">=</span> <span class="n">casvc</span><span class="o">.</span><span class="n">reenroll</span><span class="p">(</span><span class="n">user1Enrollment</span><span class="p">)</span> <span class="c1"># now local will have the user reenrolled object</span>
<span class="n">RevokedCerts</span><span class="p">,</span> <span class="n">CRL</span> <span class="o">=</span> <span class="n">adminEnrollment</span><span class="o">.</span><span class="n">revoke</span><span class="p">(</span><span class="s2">&quot;user1&quot;</span><span class="p">)</span> <span class="c1"># revoke the user if you need</span>
</pre></div>
</div>
<p>You can also use the new identity management system:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hfc.fabric_ca.caservice</span> <span class="kn">import</span> <span class="n">ca_service</span>

<span class="n">casvc</span> <span class="o">=</span> <span class="n">ca_service</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;http://127.0.0.1:7054&quot;</span><span class="p">)</span>
<span class="n">identityService</span> <span class="o">=</span> <span class="n">casvc</span><span class="o">.</span><span class="n">newIdentityService</span><span class="p">()</span>

<span class="n">admin</span> <span class="o">=</span> <span class="n">casvc</span><span class="o">.</span><span class="n">enroll</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;adminpw&quot;</span><span class="p">)</span> <span class="c1"># now local will have the admin user</span>
<span class="n">secret</span> <span class="o">=</span> <span class="n">identityService</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="c1"># create user foo</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">identityService</span><span class="o">.</span><span class="n">getOne</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="p">)</span> <span class="c1"># get user foo</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">identityService</span><span class="o">.</span><span class="n">getAll</span><span class="p">(</span><span class="n">admin</span><span class="p">)</span> <span class="c1"># get all users</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">identityService</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="p">,</span> <span class="n">maxEnrollments</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">affiliation</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">enrollmentSecret</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span> <span class="c1"># update user foo</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">identityService</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="p">)</span> <span class="c1"># delete user foo</span>
</pre></div>
</div>
<p>You can also store the newly created credentials in the FileSystemWallet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hfc.fabric_ca.caservice</span> <span class="kn">import</span> <span class="n">ca_service</span>
<span class="kn">from</span> <span class="nn">hfc.fabric_network</span> <span class="kn">import</span> <span class="n">wallet</span>

<span class="n">casvc</span> <span class="o">=</span> <span class="n">ca_service</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;http://127.0.0.1:7054&quot;</span><span class="p">)</span>
<span class="n">adminEnrollment</span> <span class="o">=</span> <span class="n">casvc</span><span class="o">.</span><span class="n">enroll</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;adminpw&quot;</span><span class="p">)</span> <span class="c1"># now local will have the admin enrollment</span>
<span class="n">secret</span> <span class="o">=</span> <span class="n">adminEnrollment</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;user1&quot;</span><span class="p">)</span> <span class="c1"># register a user to ca</span>
<span class="n">user1Enrollment</span> <span class="o">=</span> <span class="n">casvc</span><span class="o">.</span><span class="n">enroll</span><span class="p">(</span><span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span> <span class="c1"># now local will have the user enrollment</span>
<span class="n">new_wallet</span> <span class="o">=</span> <span class="n">wallet</span><span class="o">.</span><span class="n">FileSystenWallet</span><span class="p">()</span> <span class="c1"># Creates default wallet at ./tmp/hfc-kvs</span>
<span class="n">user_identity</span> <span class="o">=</span> <span class="n">wallet</span><span class="o">.</span><span class="n">Identity</span><span class="p">(</span><span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="n">user1Enrollment</span><span class="p">)</span> <span class="c1"># Creates a new Identity of the enrolled user</span>
<span class="n">user_identity</span><span class="o">.</span><span class="n">CreateIdentity</span><span class="p">(</span><span class="n">new_wallet</span><span class="p">)</span> <span class="c1"># Stores this identity in the FileSystemWallet</span>
<span class="n">user1</span> <span class="o">=</span> <span class="n">new_wallet</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="s2">&quot;Org1&quot;</span><span class="p">,</span> <span class="s2">&quot;Org1MSP&quot;</span><span class="p">)</span> <span class="c1"># Returns an instance of the user object with the newly created credentials</span>
</pre></div>
</div>
<p>You can also store the newly created credentials in the InMemoryWallet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hfc.fabric_ca.caservice</span> <span class="kn">import</span> <span class="n">ca_service</span>
<span class="kn">from</span> <span class="nn">hfc.fabric_network</span> <span class="kn">import</span> <span class="n">inmemorywallet</span>

<span class="n">casvc</span> <span class="o">=</span> <span class="n">ca_service</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;http://127.0.0.1:7054&quot;</span><span class="p">)</span>
<span class="n">adminEnrollment</span> <span class="o">=</span> <span class="n">casvc</span><span class="o">.</span><span class="n">enroll</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;adminpw&quot;</span><span class="p">)</span> <span class="c1"># now local will have the admin enrollment</span>
<span class="n">secret</span> <span class="o">=</span> <span class="n">adminEnrollment</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;user1&quot;</span><span class="p">)</span> <span class="c1"># register a user to ca</span>
<span class="n">user1Enrollment</span> <span class="o">=</span> <span class="n">casvc</span><span class="o">.</span><span class="n">enroll</span><span class="p">(</span><span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span> <span class="c1"># now local will have the user enrollment</span>
<span class="n">new_wallet</span> <span class="o">=</span> <span class="n">inmemorywallet</span><span class="o">.</span><span class="n">InMemoryWallet</span><span class="p">()</span> <span class="c1"># Creates a new instance of the class InMemoryWallet</span>
<span class="n">new_wallet</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="n">user1Enrollment</span><span class="p">)</span> <span class="c1"># Saves the credentials of &#39;user1&#39; in the wallet</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="operate-channels-with-fabric-network">
<h2>2. Operate Channels with Fabric Network<a class="headerlink" href="#operate-channels-with-fabric-network" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-a-new-channel-and-join-it">
<h3>2.1 Create a new channel and join it<a class="headerlink" href="#create-a-new-channel-and-join-it" title="Permalink to this headline">¶</a></h3>
<p>Use sdk to create a new channel and let peers join it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">hfc.fabric</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

<span class="n">cli</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">net_profile</span><span class="o">=</span><span class="s2">&quot;test/fixtures/network.json&quot;</span><span class="p">)</span>
<span class="n">org1_admin</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">org_name</span><span class="o">=</span><span class="s1">&#39;org1.example.com&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Admin&#39;</span><span class="p">)</span>

<span class="c1"># Create a New Channel, the response should be true if succeed</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">channel_create</span><span class="p">(</span>
            <span class="n">orderer</span><span class="o">=</span><span class="s1">&#39;orderer.example.com&#39;</span><span class="p">,</span>
            <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
            <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
            <span class="n">config_yaml</span><span class="o">=</span><span class="s1">&#39;test/fixtures/e2e_cli/&#39;</span><span class="p">,</span>
            <span class="n">channel_profile</span><span class="o">=</span><span class="s1">&#39;TwoOrgsChannel&#39;</span>
            <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Join Peers into Channel, the response should be true if succeed</span>
<span class="n">orderer_admin</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">org_name</span><span class="o">=</span><span class="s1">&#39;orderer.example.com&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Admin&#39;</span><span class="p">)</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">channel_join</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;peer1.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">orderer</span><span class="o">=</span><span class="s1">&#39;orderer.example.com&#39;</span>
               <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>


<span class="c1"># Join Peers from a different MSP into Channel</span>
<span class="n">org2_admin</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">org_name</span><span class="o">=</span><span class="s1">&#39;org2.example.com&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Admin&#39;</span><span class="p">)</span>

<span class="c1"># For operations on peers from org2.example.com, org2_admin is required as requestor</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">channel_join</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org2_admin</span><span class="p">,</span>
               <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org2.example.com&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;peer1.org2.example.com&#39;</span><span class="p">],</span>
               <span class="n">orderer</span><span class="o">=</span><span class="s1">&#39;orderer.example.com&#39;</span>
               <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="update-the-channel-configuration">
<h3>2.2 Update the Channel Configuration<a class="headerlink" href="#update-the-channel-configuration" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">hfc.fabric</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

<span class="n">cli</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">net_profile</span><span class="o">=</span><span class="s2">&quot;test/fixtures/network.json&quot;</span><span class="p">)</span>
<span class="n">org1_admin</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">org_name</span><span class="o">=</span><span class="s1">&#39;org1.example.com&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Admin&#39;</span><span class="p">)</span>

<span class="n">config_tx_file</span> <span class="o">=</span> <span class="s1">&#39;./configtx.yaml&#39;</span>

<span class="n">orderer_admin</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">org_name</span><span class="o">=</span><span class="s1">&#39;orderer.example.com&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Admin&#39;</span><span class="p">)</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">channel_update</span><span class="p">(</span>
        <span class="n">orderer</span><span class="o">=</span><span class="s1">&#39;orderer.example.com&#39;</span><span class="p">,</span>
        <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
        <span class="n">requestor</span><span class="o">=</span><span class="n">orderer_admin</span><span class="p">,</span>
        <span class="n">config_tx</span><span class="o">=</span><span class="n">config_tx_file</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="operate-chaincodes-with-fabric-network">
<h2>3. Operate Chaincodes with Fabric Network<a class="headerlink" href="#operate-chaincodes-with-fabric-network" title="Permalink to this headline">¶</a></h2>
<p>Use sdk to install, instantiate and invoke chaincode.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">hfc.fabric</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

<span class="n">cli</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">net_profile</span><span class="o">=</span><span class="s2">&quot;test/fixtures/network.json&quot;</span><span class="p">)</span>
<span class="n">org1_admin</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="s1">&#39;org1.example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin&#39;</span><span class="p">)</span>

<span class="c1"># Make the client know there is a channel in the network</span>
<span class="n">cli</span><span class="o">.</span><span class="n">new_channel</span><span class="p">(</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">)</span>

<span class="c1"># Install Example Chaincode to Peers</span>
<span class="c1"># GOPATH setting is only needed to use the example chaincode inside sdk</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">gopath_bak</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GOPATH&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">gopath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                      <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s1">&#39;__file__&#39;</span><span class="p">)),</span>
                      <span class="s1">&#39;test/fixtures/chaincode&#39;</span>
                     <span class="p">))</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;GOPATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">gopath</span><span class="p">)</span>

<span class="c1"># The response should be true if succeed</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">chaincode_install</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;peer1.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">cc_path</span><span class="o">=</span><span class="s1">&#39;github.com/example_cc&#39;</span><span class="p">,</span>
               <span class="n">cc_name</span><span class="o">=</span><span class="s1">&#39;example_cc&#39;</span><span class="p">,</span>
               <span class="n">cc_version</span><span class="o">=</span><span class="s1">&#39;v1.0&#39;</span>
               <span class="p">))</span>

<span class="c1"># Instantiate Chaincode in Channel, the response should be true if succeed</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;300&#39;</span><span class="p">]</span>

<span class="c1"># policy, see https://hyperledger-fabric.readthedocs.io/en/release-1.4/endorsement-policies.html</span>
<span class="n">policy</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;identities&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;member&#39;</span><span class="p">,</span> <span class="s1">&#39;mspId&#39;</span><span class="p">:</span> <span class="s1">&#39;Org1MSP&#39;</span><span class="p">}},</span>
    <span class="p">],</span>
    <span class="s1">&#39;policy&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;1-of&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;signed-by&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">chaincode_instantiate</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
               <span class="n">cc_name</span><span class="o">=</span><span class="s1">&#39;example_cc&#39;</span><span class="p">,</span>
               <span class="n">cc_version</span><span class="o">=</span><span class="s1">&#39;v1.0&#39;</span><span class="p">,</span>
               <span class="n">cc_endorsement_policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="c1"># optional, but recommended</span>
               <span class="n">collections_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># optional, for private data policy</span>
               <span class="n">transient_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># optional, for private data</span>
               <span class="n">wait_for_event</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># optional, for being sure chaincode is instantiated</span>
               <span class="p">))</span>

<span class="c1"># Invoke a chaincode</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;100&#39;</span><span class="p">]</span>
<span class="c1"># The response should be true if succeed</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">chaincode_invoke</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
               <span class="n">cc_name</span><span class="o">=</span><span class="s1">&#39;example_cc&#39;</span><span class="p">,</span>
               <span class="n">transient_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># optional, for private data</span>
               <span class="n">wait_for_event</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># for being sure chaincode invocation has been commited in the ledger, default is on tx event</span>
               <span class="c1">#cc_pattern=&#39;^invoked*&#39; # if you want to wait for chaincode event and you have a `stub.SetEvent(&quot;invoked&quot;, value)` in your chaincode</span>
               <span class="p">))</span>

<span class="c1"># Query a chaincode</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="c1"># The response should be true if succeed</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">chaincode_query</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
               <span class="n">cc_name</span><span class="o">=</span><span class="s1">&#39;example_cc&#39;</span>
               <span class="p">))</span>

<span class="c1"># Upgrade a chaincode</span>
<span class="c1"># policy, see https://hyperledger-fabric.readthedocs.io/en/release-1.4/endorsement-policies.html</span>
<span class="n">policy</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;identities&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;member&#39;</span><span class="p">,</span> <span class="s1">&#39;mspId&#39;</span><span class="p">:</span> <span class="s1">&#39;Org1MSP&#39;</span><span class="p">}},</span>
        <span class="p">{</span><span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;mspId&#39;</span><span class="p">:</span> <span class="s1">&#39;Org1MSP&#39;</span><span class="p">}},</span>
    <span class="p">],</span>
    <span class="s1">&#39;policy&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;1-of&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;signed-by&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;signed-by&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">chaincode_upgrade</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
               <span class="n">cc_name</span><span class="o">=</span><span class="s1">&#39;example_cc&#39;</span><span class="p">,</span>
               <span class="n">cc_version</span><span class="o">=</span><span class="s1">&#39;v1.0&#39;</span><span class="p">,</span>
               <span class="n">cc_endorsement_policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="c1"># optional, but recommended</span>
               <span class="n">collections_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># optional, for private data policy</span>
               <span class="n">transient_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># optional, for private data</span>
               <span class="n">wait_for_event</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># optional, for being sure chaincode is upgraded</span>
               <span class="p">))</span>               
</pre></div>
</div>
</div>
<div class="section" id="query-informations">
<h2>4. Query Informations<a class="headerlink" href="#query-informations" title="Permalink to this headline">¶</a></h2>
<p>By default, <code class="docutils literal notranslate"><span class="pre">query</span></code> methods returns a decoded response.</p>
<p>If you need to get the raw response from the ledger you can add <code class="docutils literal notranslate"><span class="pre">decode=False</span></code> param.</p>
<div class="section" id="basic-usage">
<h3>4.1 Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">hfc.fabric</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">cli</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">net_profile</span><span class="o">=</span><span class="s2">&quot;test/fixtures/network.json&quot;</span><span class="p">)</span>
<span class="n">org1_admin</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="s1">&#39;org1.example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin&#39;</span><span class="p">)</span>

<span class="c1"># Query Peer installed chaincodes, make sure the chaincode is installed</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">query_installed_chaincodes</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">decode</span><span class="o">=</span><span class="kc">True</span>
               <span class="p">))</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># An example response:</span>

<span class="sd">chaincodes {</span>
<span class="sd">  name: &quot;example_cc&quot;</span>
<span class="sd">  version: &quot;v1.0&quot;</span>
<span class="sd">  path: &quot;github.com/example_cc&quot;</span>
<span class="sd">  id: &quot;\374\361\027j(\332\225\367\253\030\242\303U&amp;\356\326\241\2003|\033\266:\314\250\032\254\221L#\006G&quot;</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Query Peer Joined channel</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">query_channels</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">decode</span><span class="o">=</span><span class="kc">True</span>
               <span class="p">))</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># An example response:</span>

<span class="sd">channels {</span>
<span class="sd">  channel_id: &quot;businesschannel&quot;</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="query-block-by-block-hash-transaction-id">
<h3>4.2 Query Block by block hash &amp; transaction id<a class="headerlink" href="#query-block-by-block-hash-transaction-id" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">hfc.fabric</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">cli</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">net_profile</span><span class="o">=</span><span class="s2">&quot;test/fixtures/network.json&quot;</span><span class="p">)</span>
<span class="n">org1_admin</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="s1">&#39;org1.example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin&#39;</span><span class="p">)</span>

<span class="c1"># first get the hash by calling &#39;query_info&#39;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">query_info</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">decode</span><span class="o">=</span><span class="kc">True</span>
               <span class="p">))</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># An example response:</span>

<span class="sd">height: 3</span>
<span class="sd">currentBlockHash: &quot;\\\255\317\341$\&quot;\371\242aP\030u\325~\263!\352G\014\007\353\353\247\235&lt;\353\020\026\345\254\252r&quot;</span>
<span class="sd">previousBlockHash: &quot;\324\214\275z\301)\351\224 \225\306\&quot;\250jBMa\3432r\035\023\310\250\017w\013\303!f\340\272&quot;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">test_hash</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">currentBlockHash</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">query_block_by_hash</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">block_hash</span><span class="o">=</span><span class="n">test_hash</span><span class="p">,</span>
               <span class="n">decode</span><span class="o">=</span><span class="kc">True</span>
               <span class="p">))</span>

<span class="n">tx_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s1">&#39;payload&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s1">&#39;channel_header&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tx_id&#39;</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">query_block_by_txid</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">tx_id</span><span class="o">=</span><span class="n">tx_id</span><span class="p">,</span>
               <span class="n">decode</span><span class="o">=</span><span class="kc">True</span>
               <span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="query-block-transaction-and-instantiated-chaincodes">
<h3>4.3 Query Block, Transaction and Instantiated Chaincodes<a class="headerlink" href="#query-block-transaction-and-instantiated-chaincodes" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">hfc.fabric</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">cli</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">net_profile</span><span class="o">=</span><span class="s2">&quot;test/fixtures/network.json&quot;</span><span class="p">)</span>
<span class="n">org1_admin</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="s1">&#39;org1.example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin&#39;</span><span class="p">)</span>

<span class="c1"># Query Block by block number</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">query_block</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">block_number</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
               <span class="n">decode</span><span class="o">=</span><span class="kc">True</span>
               <span class="p">))</span>

<span class="c1"># Query Transaction by tx id</span>
<span class="c1"># example txid of instantiated chaincode transaction</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">query_transaction</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">tx_id</span><span class="o">=</span><span class="n">tx_id</span><span class="p">,</span> <span class="c1"># tx_id same at 4.2</span>
               <span class="n">decode</span><span class="o">=</span><span class="kc">True</span>
               <span class="p">))</span>

<span class="c1"># Query Instantiated Chaincodes</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">query_instantiated_chaincodes</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">decode</span><span class="o">=</span><span class="kc">True</span>
               <span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="get-channel-configuration">
<h3>4.4 Get channel configuration<a class="headerlink" href="#get-channel-configuration" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">hfc.fabric</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">cli</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">net_profile</span><span class="o">=</span><span class="s2">&quot;test/fixtures/network.json&quot;</span><span class="p">)</span>
<span class="n">org1_admin</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="s1">&#39;org1.example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin&#39;</span><span class="p">)</span>

<span class="c1"># Get channel config</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">get_channel_config</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">channel_name</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">peers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">],</span>
               <span class="n">decode</span><span class="o">=</span><span class="kc">True</span>
               <span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="use-channel-discovery">
<h3>4.5 Use channel discovery<a class="headerlink" href="#use-channel-discovery" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">hfc.fabric</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">cli</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">net_profile</span><span class="o">=</span><span class="s2">&quot;test/fixtures/network.json&quot;</span><span class="p">)</span>
<span class="n">org1_admin</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="s1">&#39;org1.example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin&#39;</span><span class="p">)</span>

<span class="c1"># Get config from local channel discovery</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">query_peers</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">peer</span><span class="o">=</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">,</span>
               <span class="n">channel</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">decode</span><span class="o">=</span><span class="kc">True</span>
               <span class="p">))</span>

<span class="c1"># Get config from channel discovery over the network</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">query_peers</span><span class="p">(</span>
               <span class="n">requestor</span><span class="o">=</span><span class="n">org1_admin</span><span class="p">,</span>
               <span class="n">peer</span><span class="o">=</span><span class="s1">&#39;peer0.org1.example.com&#39;</span><span class="p">,</span>
               <span class="n">channel</span><span class="o">=</span><span class="s1">&#39;businesschannel&#39;</span><span class="p">,</span>
               <span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">decode</span><span class="o">=</span><span class="kc">True</span>
               <span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="license-a-name-license-a">
<h2>License <a name="license"></a><a class="headerlink" href="#license-a-name-license-a" title="Permalink to this headline">¶</a></h2>
<p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This document is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="release_note.html" class="btn btn-neutral float-right" title="Release Notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to fabric-sdk-py’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Hyperledger Community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>